-- Arceus X UI re-skinned to TCMD / Command Panel style
-- Returns `lib` with the same API as the original (AddToggle, AddButton, AddInputBox, AddComboBox, SetTitle, SetIcon, SetTheme, etc.)
-- Usage: local ui = require(path_to_this_file); local win = ui -- then use win:AddButton(...) etc.

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer

local lib = {}

-- Helper: parent to HUI if available, otherwise PlayerGui
local function uiparent()
    local success, parent = pcall(function() return gethui() end)
    if success and parent then return parent end
    return LocalPlayer and LocalPlayer:FindFirstChild("PlayerGui") or game:GetService("CoreGui")
end

-- Root ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ArceusTCMD"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = uiparent()

-- Main frame (TCMD style)
local Main = Instance.new("Frame")
Main.Name = "Main"
Main.Size = UDim2.new(0.3, 0, 0.4, 0)
Main.Position = UDim2.new(0.35, 0, 0.3, 0)
Main.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
Main.BackgroundTransparency = 0.1
Main.BorderSizePixel = 0
Main.ClipsDescendants = true
Main.Parent = ScreenGui

local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0, 8)
uiCorner.Parent = Main

local border = Instance.new("UIStroke")
border.Color = Color3.fromRGB(80, 80, 90)
border.Thickness = 1
border.Transparency = 0.5
border.Parent = Main

local pulseOutline = Instance.new("UIStroke")
pulseOutline.Color = Color3.fromRGB(150, 150, 150)
pulseOutline.Thickness = 2
pulseOutline.Transparency = 1
pulseOutline.Parent = Main

-- Header for dragging
local Header = Instance.new("Frame")
Header.Name = "Header"
Header.Size = UDim2.new(1, 0, 0.12, 0)
Header.Position = UDim2.new(0, 0, 0, 0)
Header.BackgroundTransparency = 1
Header.ZIndex = 10
Header.Parent = Main

local headerBackground = Instance.new("Frame")
headerBackground.Size = UDim2.new(1, 0, 1, 0)
headerBackground.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
headerBackground.BackgroundTransparency = 0.2
headerBackground.BorderSizePixel = 0
headerBackground.ZIndex = 1
headerBackground.Parent = Header

local headerCorner = Instance.new("UICorner")
headerCorner.CornerRadius = UDim.new(0, 8)
headerCorner.Parent = headerBackground

local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(0.7, 0, 0.8, 0)
Title.Position = UDim2.new(0.05, 0, 0.1, 0)
Title.BackgroundTransparency = 1
Title.Text = "Arceus X | UI"
Title.TextColor3 = Color3.fromRGB(220, 220, 220)
Title.TextScaled = true
Title.Font = Enum.Font.GothamSemibold
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.ZIndex = 2
Title.Parent = Header

-- Logo (small icon left)
local Logo = Instance.new("ImageButton")
Logo.Name = "Logo"
Logo.Size = UDim2.new(0.08, 0, 0.9, 0)
Logo.Position = UDim2.new(0.96, -48, 0.05, 0) -- right area for logo (kept flexible)
Logo.AnchorPoint = Vector2.new(1, 0)
Logo.BackgroundTransparency = 1
Logo.Image = "http://www.roblox.com/asset/?id=9178187770"
Logo.Parent = Header
local logoAs = Instance.new("UIAspectRatioConstraint", Logo)

-- Close button (right)
local CloseBtn = Instance.new("TextButton")
CloseBtn.Name = "Close"
CloseBtn.Size = UDim2.new(0.1, 0, 0.7, 0)
CloseBtn.Position = UDim2.new(0.88, 0, 0.15, 0)
CloseBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
CloseBtn.BackgroundTransparency = 0.7
CloseBtn.Text = "×"
CloseBtn.TextColor3 = Color3.fromRGB(220, 220, 220)
CloseBtn.TextSize = 24
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.ZIndex = 2
CloseBtn.Parent = Header

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0.5, 0)
closeCorner.Parent = CloseBtn

-- Scrolling frame (menu area)
local Menu = Instance.new("ScrollingFrame")
Menu.Name = "Menu"
Menu.Size = UDim2.new(0.95, 0, 0.85, 0)
Menu.Position = UDim2.new(0.025, 0, 0.13, 0)
Menu.BackgroundTransparency = 1
Menu.ScrollBarThickness = 6
Menu.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 110)
Menu.AutomaticCanvasSize = Enum.AutomaticSize.Y
Menu.Parent = Main

local categoriesContainer = Instance.new("Frame")
categoriesContainer.Name = "Categories"
categoriesContainer.Size = UDim2.new(1, 0, 1, 0)
categoriesContainer.BackgroundTransparency = 1
categoriesContainer.Parent = Menu

local categoriesLayout = Instance.new("UIListLayout")
categoriesLayout.Padding = UDim.new(0, 12)
categoriesLayout.Parent = categoriesContainer

-- Templates for elements (small, hidden clones)
-- Button template
local ButtonTemplate = Instance.new("TextButton")
ButtonTemplate.Name = "ButtonTemplate"
ButtonTemplate.Size = UDim2.new(1, -10, 0, 36)
ButtonTemplate.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
ButtonTemplate.BorderSizePixel = 0
ButtonTemplate.AutoButtonColor = false
ButtonTemplate.TextColor3 = Color3.fromRGB(230, 230, 230)
ButtonTemplate.Font = Enum.Font.Gotham
ButtonTemplate.TextSize = 14
local btCorner = Instance.new("UICorner", ButtonTemplate)
btCorner.CornerRadius = UDim.new(0, 6)

-- Toggle template (a frame with a visible indicator)
local ToggleTemplate = Instance.new("Frame")
ToggleTemplate.Name = "ToggleTemplate"
ToggleTemplate.Size = UDim2.new(1, -10, 0, 36)
ToggleTemplate.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
ToggleTemplate.BorderSizePixel = 0
local togCorner = Instance.new("UICorner", ToggleTemplate)
togCorner.CornerRadius = UDim.new(0, 6)
local ToggleLabel = Instance.new("TextLabel", ToggleTemplate)
ToggleLabel.Name = "Label"
ToggleLabel.Size = UDim2.new(0.8, 0, 1, 0)
ToggleLabel.Position = UDim2.new(0, 8, 0, 0)
ToggleLabel.BackgroundTransparency = 1
ToggleLabel.Font = Enum.Font.Gotham
ToggleLabel.TextSize = 14
ToggleLabel.TextColor3 = Color3.fromRGB(230, 230, 230)
ToggleLabel.TextXAlignment = Enum.TextXAlignment.Left
local ToggleSwitch = Instance.new("Frame", ToggleTemplate)
ToggleSwitch.Name = "Switch"
ToggleSwitch.Size = UDim2.new(0.15, 0, 0.6, 0)
ToggleSwitch.AnchorPoint = Vector2.new(1, 0.5)
ToggleSwitch.Position = UDim2.new(1, -8, 0.5, 0)
ToggleSwitch.BackgroundColor3 = Color3.fromRGB(180, 180, 180)
local switchCorner = Instance.new("UICorner", ToggleSwitch)
switchCorner.CornerRadius = UDim.new(0, 8)

-- Combo box template (collapsible)
local ComboTemplate = Instance.new("TextButton")
ComboTemplate.Name = "ComboTemplate"
ComboTemplate.Size = UDim2.new(1, -10, 0, 36)
ComboTemplate.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
ComboTemplate.BorderSizePixel = 0
ComboTemplate.AutoButtonColor = false
local comboCorner = Instance.new("UICorner", ComboTemplate)
comboCorner.CornerRadius = UDim.new(0, 6)
local comboLabel = Instance.new("TextLabel", ComboTemplate)
comboLabel.Name = "Label"
comboLabel.Size = UDim2.new(0.8, 0, 1, 0)
comboLabel.Position = UDim2.new(0, 8, 0, 0)
comboLabel.BackgroundTransparency = 1
comboLabel.Font = Enum.Font.Gotham
comboLabel.TextSize = 14
comboLabel.TextColor3 = Color3.fromRGB(230, 230, 230)
comboLabel.TextXAlignment = Enum.TextXAlignment.Left
local comboArrow = Instance.new("TextLabel", ComboTemplate)
comboArrow.Name = "Arrow"
comboArrow.Size = UDim2.new(0.12, 0, 1, 0)
comboArrow.Position = UDim2.new(0.88, -6, 0, 0)
comboArrow.BackgroundTransparency = 1
comboArrow.Font = Enum.Font.GothamBold
comboArrow.TextSize = 16
comboArrow.Text = "▾"
comboArrow.TextColor3 = Color3.fromRGB(200,200,200)

-- Combo item template (hidden)
local ComboItemTemplate = Instance.new("TextButton")
ComboItemTemplate.Name = "ComboItem"
ComboItemTemplate.Size = UDim2.new(1, -20, 0, 30)
ComboItemTemplate.BackgroundColor3 = Color3.fromRGB(55, 55, 60)
ComboItemTemplate.BorderSizePixel = 0
ComboItemTemplate.AutoButtonColor = false
local ciCorner = Instance.new("UICorner", ComboItemTemplate)
ciCorner.CornerRadius = UDim.new(0, 6)
local ciLabel = Instance.new("TextLabel", ComboItemTemplate)
ciLabel.Name = "Label"
ciLabel.Size = UDim2.new(1, -10, 1, 0)
ciLabel.Position = UDim2.new(0, 8, 0, 0)
ciLabel.BackgroundTransparency = 1
ciLabel.Font = Enum.Font.Gotham
ciLabel.TextSize = 13
ciLabel.TextColor3 = Color3.fromRGB(220, 220, 220)
ciLabel.TextXAlignment = Enum.TextXAlignment.Left

-- Input box template
local InputTemplate = Instance.new("Frame")
InputTemplate.Name = "InputTemplate"
InputTemplate.Size = UDim2.new(1, -10, 0, 36)
InputTemplate.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
InputTemplate.BorderSizePixel = 0
local inputCorner = Instance.new("UICorner", InputTemplate)
inputCorner.CornerRadius = UDim.new(0, 6)
local InputLabel = Instance.new("TextLabel", InputTemplate)
InputLabel.Name = "Label"
InputLabel.Size = UDim2.new(0.5, 0, 1, 0)
InputLabel.Position = UDim2.new(0, 8, 0, 0)
InputLabel.BackgroundTransparency = 1
InputLabel.Font = Enum.Font.Gotham
InputLabel.TextSize = 14
InputLabel.TextColor3 = Color3.fromRGB(230, 230, 230)
InputLabel.TextXAlignment = Enum.TextXAlignment.Left
local TextBox = Instance.new("TextBox", InputTemplate)
TextBox.Name = "Box"
TextBox.Size = UDim2.new(0.45, -12, 0.8, 0)
TextBox.AnchorPoint = Vector2.new(1, 0.5)
TextBox.Position = UDim2.new(0.98, -8, 0.5, 0)
TextBox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
TextBox.TextColor3 = Color3.fromRGB(230,230,230)
TextBox.Font = Enum.Font.Gotham
TextBox.TextSize = 14
TextBox.PlaceholderColor3 = Color3.fromRGB(160,160,160)
TextBox.Text = ""
local tbCorner = Instance.new("UICorner", TextBox)
tbCorner.CornerRadius = UDim.new(0, 6)

-- Internal variables
local elementsCount = 0
local elementSpacing = 8

-- Small helper to create a container entry (wrap item into categoriesContainer as a frame)
local function pushElementToMenu(element)
    element.LayoutOrder = elementsCount
    element.Parent = categoriesContainer
    elementsCount = elementsCount + 1
end

-- Add space (padding)
local function addSpace(size)
    local spacer = Instance.new("Frame")
    spacer.Name = "Spacer"
    spacer.Size = UDim2.new(1, 0, 0, size or elementSpacing)
    spacer.BackgroundTransparency = 1
    pushElementToMenu(spacer)
end

-- API: AddButton(name, funct, ...)
function lib:AddButton(name, funct, ...)
    local args = {...}
    local btn = ButtonTemplate:Clone()
    btn.Text = name -- use Text for accessibility
    btn.MouseButton1Click:Connect(function()
        pcall(funct, unpack(args))
    end)
    -- Put a displayed label to keep consistent look
    btn.Text = ""
    btn.Parent = nil
    local lbl = btn:FindFirstChildOfClass("TextLabel")
    if not lbl then
        lbl = Instance.new("TextLabel", btn)
    end
    lbl.Name = "Label"
    lbl.Size = UDim2.new(1, 0, 1, 0)
    lbl.BackgroundTransparency = 1
    lbl.Font = Enum.Font.Gotham
    lbl.TextSize = 14
    lbl.TextColor3 = Color3.fromRGB(230,230,230)
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.Text = "  " .. (name or "Button")
    pushElementToMenu(btn)
    addSpace(4)
    return btn
end

-- API: AddToggle(name, funct, enabled, ...)
function lib:AddToggle(name, funct, enabled, ...)
    local args = {...}
    local frame = ToggleTemplate:Clone()
    frame.Name = name or "Toggle"
    local label = frame:FindFirstChild("Label")
    label.Text = name or "Toggle"
    local switch = frame:FindFirstChild("Switch")
    -- set initial
    switch.BackgroundColor3 = enabled and Color3.fromRGB(86, 76, 251) or Color3.fromRGB(180,180,180)

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            enabled = not enabled
            switch.BackgroundColor3 = enabled and Color3.fromRGB(86, 76, 251) or Color3.fromRGB(180,180,180)
            pcall(funct, enabled, unpack(args))
        end
    end)

    pushElementToMenu(frame)
    addSpace(4)
    return frame
end

-- API: AddInputBox(name, funct, placeholder, default, ...)
function lib:AddInputBox(name, funct, placeholder, default, ...)
    local args = {...}
    local inpFrame = InputTemplate:Clone()
    inpFrame.Name = name or "Input"
    local label = inpFrame:FindFirstChild("Label")
    label.Text = name or "Input"
    local tb = inpFrame:FindFirstChild("Box")
    if placeholder then tb.PlaceholderText = placeholder end
    if default then tb.Text = default end

    local function submitText()
        local text = tb.Text
        pcall(funct, text, unpack(args))
    end

    tb.FocusLost:Connect(function(enter)
        if enter then submitText() end
    end)
    -- clicking the frame focuses the box
    inpFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            if not tb:IsFocused() then tb:CaptureFocus() end
        end
    end)

    pushElementToMenu(inpFrame)
    addSpace(4)

    -- Return control object
    local inputObj = {
        Frame = inpFrame,
        TextBox = tb,
        GetText = function() return tb.Text end,
        SetText = function(txt) tb.Text = txt or "" end,
        Clear = function() tb.Text = "" end,
        SetPlaceholder = function(p) tb.PlaceholderText = p or "" end,
    }
    return inputObj
end

-- API: AddComboBox(text, options, funct, ...)
function lib:AddComboBox(text, options, funct, ...)
    local args = {...}
    local combo = ComboTemplate:Clone()
    combo.Name = text or "Combo"
    local label = combo:FindFirstChild("Label")
    local arrow = combo:FindFirstChild("Arrow")
    label.Text = (text or "Combo") .. ": " .. (options[1] or "")
    combo.AutoButtonColor = false

    local expanded = false
    local items = {}

    local function setArrow()
        arrow.Text = expanded and "▴" or "▾"
    end

    combo.MouseButton1Click:Connect(function()
        expanded = not expanded
        setArrow()
        for _, it in ipairs(items) do
            it.Visible = expanded
        end
    end)

    pushElementToMenu(combo)
    addSpace(4)

    for _, opt in ipairs(options) do
        local it = ComboItemTemplate:Clone()
        it.Name = opt
        it.Visible = false
        it.Label.Text = "  " .. tostring(opt)
        it.AutoButtonColor = false
        it.MouseButton1Click:Connect(function()
            label.Text = (text or "Combo") .. ": " .. tostring(opt)
            expanded = false
            setArrow()
            for _, v in ipairs(items) do v.Visible = false end
            pcall(funct, opt, unpack(args))
        end)
        pushElementToMenu(it)
        table.insert(items, it)
        addSpace(4)
    end

    return combo
end

-- Styling APIs
function lib:SetTitle(txt)
    Title.Text = tostring(txt or "Arceus X | UI")
end

function lib:SetIcon(img)
    Logo.Image = img or Logo.Image
end

function lib:SetBackgroundColor(r, g, b)
    Main.BackgroundColor3 = Color3.fromRGB(r, g, b)
    headerBackground.BackgroundColor3 = Color3.fromRGB(math.clamp(r+10,0,255), math.clamp(g+10,0,255), math.clamp(b+10,0,255))
end

function lib:SetTitleColor(r, g, b)
    Title.TextColor3 = Color3.fromRGB(r, g, b)
end

function lib:SetCloseBtnColor(r, g, b)
    CloseBtn.TextColor3 = Color3.fromRGB(r, g, b)
    -- small accents
    Logo.ImageTransparency = 0
end

function lib:SetButtonsColor(r, g, b)
    -- Change templates' colors (existing elements won't be updated automatically)
    ButtonTemplate.BackgroundColor3 = Color3.fromRGB(r, g, b)
    ToggleTemplate.BackgroundColor3 = Color3.fromRGB(r, g, b)
    ComboTemplate.BackgroundColor3 = Color3.fromRGB(r, g, b)
    InputTemplate.BackgroundColor3 = Color3.fromRGB(r, g, b)
end

function lib:SetInputBoxColor(r, g, b)
    InputTemplate.BackgroundColor3 = Color3.fromRGB(r, g, b)
    TextBox.BackgroundColor3 = Color3.fromRGB(math.max(0, r-15), math.max(0, g-15), math.max(0, b-15))
end

function lib:SetTheme(theme)
    if theme == "Default" then
        lib:SetBackgroundColor(40,40,45)
        lib:SetButtonsColor(60,60,65)
        lib:SetCloseBtnColor(220,220,220)
        lib:SetInputBoxColor(60,60,65)
    elseif theme == "TomorrowNightBlue" then
        lib:SetButtonsColor(74,208,238)
        lib:SetCloseBtnColor(74,208,238)
        lib:SetBackgroundColor(5,16,58)
        lib:SetInputBoxColor(74,208,238)
    elseif theme == "Aqua" then
        lib:SetBackgroundColor(44,62,82)
        lib:SetButtonsColor(52,74,95)
        lib:SetCloseBtnColor(26,189,158)
        lib:SetInputBoxColor(52,74,95)
    else
        error("Theme not found.")
    end
end

-- Dragging implementation (TCMD-like)
do
    local dragging = false
    local dragStart = nil
    local startPos = nil
    local connection

    local function updateInput(input)
        local delta = input.Position - dragStart
        local newX = startPos.X.Offset + delta.X
        local newY = startPos.Y.Offset + delta.Y

        local viewport = workspace.CurrentCamera and workspace.CurrentCamera.ViewportSize or Vector2.new(1920, 1080)
        local frameSize = Main.AbsoluteSize

        newX = math.clamp(newX, 0, viewport.X - frameSize.X)
        newY = math.clamp(newY, 0, viewport.Y - frameSize.Y)

        Main.Position = UDim2.new(startPos.X.Scale, newX, startPos.Y.Scale, newY)
    end

    Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = Main.Position

            pulseOutline.Transparency = 0
            TweenService:Create(pulseOutline, TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                Transparency = 1
            }):Play()

            connection = input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                    if connection then connection:Disconnect(); connection = nil end
                end
            end)
        end
    end)

    Header.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            updateInput(input)
        end
    end)
end

-- Close/Toggle behavior (with tween)
local isOpen = true
local function toggleUI()
    isOpen = not isOpen
    if isOpen then
        Main.Visible = true
        Main.Size = UDim2.new(0, 0, 0.4, 0)
        Main.Position = UDim2.new(0.5, 0, 0.3, 0)
        TweenService:Create(Main, TweenInfo.new(0.28, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            Size = UDim2.new(0.3, 0, 0.4, 0),
            Position = UDim2.new(0.35, 0, 0.3, 0),
            BackgroundTransparency = 0.1
        }):Play()
    else
        TweenService:Create(Main, TweenInfo.new(0.28, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
            Size = UDim2.new(0, 0, 0.4, 0),
            Position = UDim2.new(0.5, 0, 0.3, 0),
            BackgroundTransparency = 1
        }):Play()
        task.delay(0.3, function()
            Main.Visible = false
        end)
    end
end

CloseBtn.MouseButton1Click:Connect(toggleUI)
-- also allow Logo click to focus/toggle as small UX helper
Logo.MouseButton1Click:Connect(function()
    toggleUI()
end)

-- Ensure the canvas resizes to content
categoriesLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    Menu.CanvasSize = UDim2.new(0, 0, 0, categoriesLayout.AbsoluteContentSize.Y + 12)
end)

-- Initialize position/tweens like original
Main.Position = UDim2.new(0.5, 0, -0.2, 0)
Main.AnchorPoint = Vector2.new(0,0)
TweenService:Create(Main, TweenInfo.new(1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
    Position = UDim2.new(0.35, 0, 0.3, 0)
}):Play()

-- Small convenience: AddSpace and exposed reference to Menu for advanced users
lib._Menu = Menu
lib._Main = Main

return lib
