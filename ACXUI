-- TCMD UI Library - Based on Command Panel Design
local TCMD = {}

-- Services
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Colors and Themes
local Theme = {
    Background = Color3.fromRGB(40, 40, 45),
    Header = Color3.fromRGB(50, 50, 55),
    Primary = Color3.fromRGB(86, 76, 251),
    Secondary = Color3.fromRGB(100, 100, 110),
    Text = Color3.fromRGB(220, 220, 220),
    Accent = Color3.fromRGB(255, 180, 255),
    Success = Color3.fromRGB(76, 175, 80),
    Warning = Color3.fromRGB(255, 193, 7),
    Error = Color3.fromRGB(244, 67, 54)
}

-- Create Main GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "TCMDUILibrary"
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Create Main Window
local mainWindow = Instance.new("Frame")
mainWindow.Name = "MainWindow"
mainWindow.Size = UDim2.new(0.3, 0, 0.5, 0)
mainWindow.Position = UDim2.new(0.35, 0, 0.25, 0)
mainWindow.BackgroundColor3 = Theme.Background
mainWindow.BackgroundTransparency = 0.1
mainWindow.BorderSizePixel = 0
mainWindow.ClipsDescendants = true
mainWindow.Parent = screenGui

-- Window Styling
local windowCorner = Instance.new("UICorner")
windowCorner.CornerRadius = UDim.new(0, 12)
windowCorner.Parent = mainWindow

local windowBorder = Instance.new("UIStroke")
windowBorder.Color = Theme.Secondary
windowBorder.Thickness = 1
windowBorder.Transparency = 0.5
windowBorder.Parent = mainWindow

-- Header
local header = Instance.new("Frame")
header.Name = "Header"
header.Size = UDim2.new(1, 0, 0.12, 0)
header.BackgroundTransparency = 1
header.ZIndex = 10
header.Parent = mainWindow

local headerBackground = Instance.new("Frame")
headerBackground.Size = UDim2.new(1, 0, 1, 0)
headerBackground.BackgroundColor3 = Theme.Header
headerBackground.BackgroundTransparency = 0.2
headerBackground.BorderSizePixel = 0
headerBackground.ZIndex = 1
headerBackground.Parent = header

local headerCorner = Instance.new("UICorner")
headerCorner.CornerRadius = UDim.new(0, 12)
headerCorner.Parent = headerBackground

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(0.7, 0, 0.8, 0)
title.Position = UDim2.new(0.1, 0, 0.1, 0)
title.BackgroundTransparency = 1
title.Text = " TCMD | UI LIBRARY"
title.TextColor3 = Theme.Text
title.TextScaled = true
title.Font = Enum.Font.GothamSemibold
title.TextXAlignment = Enum.TextXAlignment.Left
title.ZIndex = 2
title.Parent = header

-- Close Button
local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0.1, 0, 0.7, 0)
closeButton.Position = UDim2.new(0.88, 0, 0.15, 0)
closeButton.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
closeButton.BackgroundTransparency = 0.7
closeButton.Text = "×"
closeButton.TextColor3 = Theme.Text
closeButton.TextSize = 24
closeButton.Font = Enum.Font.GothamBold
closeButton.ZIndex = 2
closeButton.Parent = header

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0.5, 0)
closeCorner.Parent = closeButton

-- Tab System
local tabsContainer = Instance.new("Frame")
tabsContainer.Name = "Tabs"
tabsContainer.Size = UDim2.new(1, 0, 0.1, 0)
tabsContainer.Position = UDim2.new(0, 0, 0.12, 0)
tabsContainer.BackgroundTransparency = 1
tabsContainer.Parent = mainWindow

-- Content Area
local contentFrame = Instance.new("ScrollingFrame")
contentFrame.Name = "Content"
contentFrame.Size = UDim2.new(0.95, 0, 0.75, 0)
contentFrame.Position = UDim2.new(0.025, 0, 0.25, 0)
contentFrame.BackgroundTransparency = 1
contentFrame.ScrollBarThickness = 4
contentFrame.ScrollBarImageColor3 = Theme.Secondary
contentFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
contentFrame.Parent = mainWindow

local contentLayout = Instance.new("UIListLayout")
contentLayout.Padding = UDim.new(0, 10)
contentLayout.Parent = contentFrame

-- Dragging System
local dragging = false
local dragInput, dragStart, startPos

local function updateInput(input)
    local delta = input.Position - dragStart
    local newPos = UDim2.new(
        startPos.X.Scale, 
        startPos.X.Offset + delta.X,
        startPos.Y.Scale, 
        startPos.Y.Offset + delta.Y
    )
    
    local viewportSize = workspace.CurrentCamera.ViewportSize
    local windowSize = mainWindow.AbsoluteSize
    
    newPos = UDim2.new(
        newPos.X.Scale,
        math.clamp(newPos.X.Offset, 0, viewportSize.X - windowSize.X),
        newPos.Y.Scale,
        math.clamp(newPos.Y.Offset, 0, viewportSize.Y - windowSize.Y)
    )
    
    mainWindow.Position = newPos
end

header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainWindow.Position

        local connection
        connection = input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
                connection:Disconnect()
            end
        end)
    end
end)

header.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        updateInput(input)
    end
end)

-- Element Templates
local ElementTemplates = {}

-- Button Template
ElementTemplates.Button = function()
    local button = Instance.new("Frame")
    button.Name = "Button"
    button.Size = UDim2.new(1, 0, 0, 40)
    button.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
    button.BackgroundTransparency = 0.8
    button.BorderSizePixel = 0
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 8)
    buttonCorner.Parent = button
    
    local buttonBorder = Instance.new("UIStroke")
    buttonBorder.Color = Theme.Primary
    buttonBorder.Thickness = 1
    buttonBorder.Transparency = 0.6
    buttonBorder.Parent = button
    
    local buttonText = Instance.new("TextLabel")
    buttonText.Name = "Text"
    buttonText.Size = UDim2.new(1, -20, 1, 0)
    buttonText.Position = UDim2.new(0, 10, 0, 0)
    buttonText.BackgroundTransparency = 1
    buttonText.Text = "Button"
    buttonText.TextColor3 = Theme.Text
    buttonText.TextSize = 14
    buttonText.Font = Enum.Font.GothamSemibold
    buttonText.TextXAlignment = Enum.TextXAlignment.Left
    buttonText.Parent = button
    
    local buttonClick = Instance.new("TextButton")
    buttonClick.Name = "ClickArea"
    buttonClick.Size = UDim2.new(1, 0, 1, 0)
    buttonClick.BackgroundTransparency = 1
    buttonClick.Text = ""
    buttonClick.ZIndex = 2
    buttonClick.Parent = button
    
    -- Hover Effects
    buttonClick.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {
            BackgroundTransparency = 0.7,
            BackgroundColor3 = Color3.fromRGB(60, 60, 70)
        }):Play()
        TweenService:Create(buttonBorder, TweenInfo.new(0.2), {
            Transparency = 0.3
        }):Play()
    end)
    
    buttonClick.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {
            BackgroundTransparency = 0.8,
            BackgroundColor3 = Color3.fromRGB(50, 50, 55)
        }):Play()
        TweenService:Create(buttonBorder, TweenInfo.new(0.2), {
            Transparency = 0.6
        }):Play()
    end)
    
    -- Click Effect
    buttonClick.MouseButton1Click:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.1), {
            BackgroundTransparency = 0.6
        }):Play()
        task.wait(0.1)
        TweenService:Create(button, TweenInfo.new(0.1), {
            BackgroundTransparency = 0.8
        }):Play()
    end)
    
    return button
end

-- Toggle Template
ElementTemplates.Toggle = function()
    local toggle = Instance.new("Frame")
    toggle.Name = "Toggle"
    toggle.Size = UDim2.new(1, 0, 0, 40)
    toggle.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
    toggle.BackgroundTransparency = 0.8
    toggle.BorderSizePixel = 0
    
    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(0, 8)
    toggleCorner.Parent = toggle
    
    local toggleBorder = Instance.new("UIStroke")
    toggleBorder.Color = Theme.Primary
    toggleBorder.Thickness = 1
    toggleBorder.Transparency = 0.6
    toggleBorder.Parent = toggle
    
    local toggleText = Instance.new("TextLabel")
    toggleText.Name = "Text"
    toggleText.Size = UDim2.new(0.7, -10, 1, 0)
    toggleText.Position = UDim2.new(0, 10, 0, 0)
    toggleText.BackgroundTransparency = 1
    toggleText.Text = "Toggle"
    toggleText.TextColor3 = Theme.Text
    toggleText.TextSize = 14
    toggleText.Font = Enum.Font.GothamSemibold
    toggleText.TextXAlignment = Enum.TextXAlignment.Left
    toggleText.Parent = toggle
    
    local toggleSwitch = Instance.new("Frame")
    toggleSwitch.Name = "Switch"
    toggleSwitch.Size = UDim2.new(0.15, 0, 0.6, 0)
    toggleSwitch.Position = UDim2.new(0.83, 0, 0.2, 0)
    toggleSwitch.BackgroundColor3 = Color3.fromRGB(70, 70, 75)
    toggleSwitch.BorderSizePixel = 0
    
    local switchCorner = Instance.new("UICorner")
    switchCorner.CornerRadius = UDim.new(0.5, 0)
    switchCorner.Parent = toggleSwitch
    
    local toggleDot = Instance.new("Frame")
    toggleDot.Name = "Dot"
    toggleDot.Size = UDim2.new(0.4, 0, 0.8, 0)
    toggleDot.Position = UDim2.new(0.05, 0, 0.1, 0)
    toggleDot.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
    toggleDot.BorderSizePixel = 0
    
    local dotCorner = Instance.new("UICorner")
    dotCorner.CornerRadius = UDim.new(0.5, 0)
    dotCorner.Parent = toggleDot
    toggleDot.Parent = toggleSwitch
    toggleSwitch.Parent = toggle
    
    local toggleClick = Instance.new("TextButton")
    toggleClick.Name = "ClickArea"
    toggleClick.Size = UDim2.new(1, 0, 1, 0)
    toggleClick.BackgroundTransparency = 1
    toggleClick.Text = ""
    toggleClick.ZIndex = 2
    toggleClick.Parent = toggle
    
    return toggle
end

-- Slider Template
ElementTemplates.Slider = function()
    local slider = Instance.new("Frame")
    slider.Name = "Slider"
    slider.Size = UDim2.new(1, 0, 0, 60)
    slider.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
    slider.BackgroundTransparency = 0.8
    slider.BorderSizePixel = 0
    
    local sliderCorner = Instance.new("UICorner")
    sliderCorner.CornerRadius = UDim.new(0, 8)
    sliderCorner.Parent = slider
    
    local sliderBorder = Instance.new("UIStroke")
    sliderBorder.Color = Theme.Primary
    sliderBorder.Thickness = 1
    sliderBorder.Transparency = 0.6
    sliderBorder.Parent = slider
    
    local sliderText = Instance.new("TextLabel")
    sliderText.Name = "Text"
    sliderText.Size = UDim2.new(1, -20, 0.4, 0)
    sliderText.Position = UDim2.new(0, 10, 0, 5)
    sliderText.BackgroundTransparency = 1
    sliderText.Text = "Slider"
    sliderText.TextColor3 = Theme.Text
    sliderText.TextSize = 14
    sliderText.Font = Enum.Font.GothamSemibold
    sliderText.TextXAlignment = Enum.TextXAlignment.Left
    sliderText.Parent = slider
    
    local sliderValue = Instance.new("TextLabel")
    sliderValue.Name = "Value"
    sliderValue.Size = UDim2.new(0.2, 0, 0.4, 0)
    sliderValue.Position = UDim2.new(0.78, 0, 0, 5)
    sliderValue.BackgroundTransparency = 1
    sliderValue.Text = "50"
    sliderValue.TextColor3 = Theme.Accent
    sliderValue.TextSize = 14
    sliderValue.Font = Enum.Font.GothamBold
    sliderValue.TextXAlignment = Enum.TextXAlignment.Right
    sliderValue.Parent = slider
    
    local sliderTrack = Instance.new("Frame")
    sliderTrack.Name = "Track"
    sliderTrack.Size = UDim2.new(0.9, 0, 0.2, 0)
    sliderTrack.Position = UDim2.new(0.05, 0, 0.65, 0)
    sliderTrack.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
    sliderTrack.BorderSizePixel = 0
    
    local trackCorner = Instance.new("UICorner")
    trackCorner.CornerRadius = UDim.new(0.5, 0)
    trackCorner.Parent = sliderTrack
    
    local sliderFill = Instance.new("Frame")
    sliderFill.Name = "Fill"
    sliderFill.Size = UDim2.new(0.5, 0, 1, 0)
    sliderFill.BackgroundColor3 = Theme.Primary
    sliderFill.BorderSizePixel = 0
    
    local fillCorner = Instance.new("UICorner")
    fillCorner.CornerRadius = UDim.new(0.5, 0)
    fillCorner.Parent = sliderFill
    sliderFill.Parent = sliderTrack
    sliderTrack.Parent = slider
    
    local sliderButton = Instance.new("TextButton")
    sliderButton.Name = "SliderButton"
    sliderButton.Size = UDim2.new(1, 0, 1, 0)
    sliderButton.BackgroundTransparency = 1
    sliderButton.Text = ""
    sliderButton.Parent = slider
    
    return slider
end

-- Dropdown Template
ElementTemplates.Dropdown = function()
    local dropdown = Instance.new("Frame")
    dropdown.Name = "Dropdown"
    dropdown.Size = UDim2.new(1, 0, 0, 40)
    dropdown.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
    dropdown.BackgroundTransparency = 0.8
    dropdown.BorderSizePixel = 0
    
    local dropdownCorner = Instance.new("UICorner")
    dropdownCorner.CornerRadius = UDim.new(0, 8)
    dropdownCorner.Parent = dropdown
    
    local dropdownBorder = Instance.new("UIStroke")
    dropdownBorder.Color = Theme.Primary
    dropdownBorder.Thickness = 1
    dropdownBorder.Transparency = 0.6
    dropdownBorder.Parent = dropdown
    
    local dropdownText = Instance.new("TextLabel")
    dropdownText.Name = "Text"
    dropdownText.Size = UDim2.new(0.8, -10, 1, 0)
    dropdownText.Position = UDim2.new(0, 10, 0, 0)
    dropdownText.BackgroundTransparency = 1
    dropdownText.Text = "Dropdown"
    dropdownText.TextColor3 = Theme.Text
    dropdownText.TextSize = 14
    dropdownText.Font = Enum.Font.GothamSemibold
    dropdownText.TextXAlignment = Enum.TextXAlignment.Left
    dropdownText.Parent = dropdown
    
    local dropdownArrow = Instance.new("TextLabel")
    dropdownArrow.Name = "Arrow"
    dropdownArrow.Size = UDim2.new(0.1, 0, 0.6, 0)
    dropdownArrow.Position = UDim2.new(0.87, 0, 0.2, 0)
    dropdownArrow.BackgroundTransparency = 1
    dropdownArrow.Text = "▼"
    dropdownArrow.TextColor3 = Theme.Text
    dropdownArrow.TextSize = 14
    dropdownArrow.Font = Enum.Font.GothamBold
    dropdownArrow.Parent = dropdown
    
    local dropdownButton = Instance.new("TextButton")
    dropdownButton.Name = "DropdownButton"
    dropdownButton.Size = UDim2.new(1, 0, 1, 0)
    dropdownButton.BackgroundTransparency = 1
    dropdownButton.Text = ""
    dropdownButton.Parent = dropdown
    
    -- Dropdown options container (initially hidden)
    local optionsContainer = Instance.new("Frame")
    optionsContainer.Name = "Options"
    optionsContainer.Size = UDim2.new(1, 0, 0, 0)
    optionsContainer.Position = UDim2.new(0, 0, 1, 5)
    optionsContainer.BackgroundColor3 = Color3.fromRGB(45, 45, 50)
    optionsContainer.BackgroundTransparency = 0.9
    optionsContainer.Visible = false
    optionsContainer.ClipsDescendants = true
    
    local optionsCorner = Instance.new("UICorner")
    optionsCorner.CornerRadius = UDim.new(0, 8)
    optionsCorner.Parent = optionsContainer
    
    local optionsBorder = Instance.new("UIStroke")
    optionsBorder.Color = Theme.Primary
    optionsBorder.Thickness = 1
    optionsBorder.Transparency = 0.6
    optionsBorder.Parent = optionsContainer
    
    local optionsLayout = Instance.new("UIListLayout")
    optionsLayout.Parent = optionsContainer
    
    optionsContainer.Parent = dropdown
    
    return dropdown
end

-- TextBox Template
ElementTemplates.TextBox = function()
    local textbox = Instance.new("Frame")
    textbox.Name = "TextBox"
    textbox.Size = UDim2.new(1, 0, 0, 50)
    textbox.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
    textbox.BackgroundTransparency = 0.8
    textbox.BorderSizePixel = 0
    
    local textboxCorner = Instance.new("UICorner")
    textboxCorner.CornerRadius = UDim.new(0, 8)
    textboxCorner.Parent = textbox
    
    local textboxBorder = Instance.new("UIStroke")
    textboxBorder.Color = Theme.Primary
    textboxBorder.Thickness = 1
    textboxBorder.Transparency = 0.6
    textboxBorder.Parent = textbox
    
    local textboxLabel = Instance.new("TextLabel")
    textboxLabel.Name = "Label"
    textboxLabel.Size = UDim2.new(1, -20, 0.4, 0)
    textboxLabel.Position = UDim2.new(0, 10, 0, 5)
    textboxLabel.BackgroundTransparency = 1
    textboxLabel.Text = "Text Box"
    textboxLabel.TextColor3 = Theme.Text
    textboxLabel.TextSize = 14
    textboxLabel.Font = Enum.Font.GothamSemibold
    textboxLabel.TextXAlignment = Enum.TextXAlignment.Left
    textboxLabel.Parent = textbox
    
    local inputBox = Instance.new("TextBox")
    inputBox.Name = "Input"
    inputBox.Size = UDim2.new(0.95, 0, 0.5, 0)
    inputBox.Position = UDim2.new(0.025, 0, 0.45, 0)
    inputBox.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
    inputBox.BackgroundTransparency = 0.7
    inputBox.TextColor3 = Theme.Text
    inputBox.PlaceholderColor3 = Color3.fromRGB(150, 150, 160)
    inputBox.PlaceholderText = "Enter text..."
    inputBox.Text = ""
    inputBox.TextSize = 14
    inputBox.Font = Enum.Font.Gotham
    inputBox.ClearTextOnFocus = false
    
    local inputCorner = Instance.new("UICorner")
    inputCorner.CornerRadius = UDim.new(0, 6)
    inputCorner.Parent = inputBox
    
    local inputBorder = Instance.new("UIStroke")
    inputBorder.Color = Theme.Secondary
    inputBorder.Thickness = 1
    inputBorder.Transparency = 0.7
    inputBorder.Parent = inputBox
    
    inputBox.Parent = textbox
    
    -- Focus effects
    inputBox.Focused:Connect(function()
        TweenService:Create(inputBox, TweenInfo.new(0.2), {
            BackgroundTransparency = 0.5
        }):Play()
        TweenService:Create(inputBorder, TweenInfo.new(0.2), {
            Color = Theme.Primary,
            Transparency = 0.4
        }):Play()
    end)
    
    inputBox.FocusLost:Connect(function()
        TweenService:Create(inputBox, TweenInfo.new(0.2), {
            BackgroundTransparency = 0.7
        }):Play()
        TweenService:Create(inputBorder, TweenInfo.new(0.2), {
            Color = Theme.Secondary,
            Transparency = 0.7
        }):Play()
    end)
    
    return textbox
end

-- Label Template
ElementTemplates.Label = function()
    local label = Instance.new("Frame")
    label.Name = "Label"
    label.Size = UDim2.new(1, 0, 0, 30)
    label.BackgroundTransparency = 1
    label.BorderSizePixel = 0
    
    local labelText = Instance.new("TextLabel")
    labelText.Name = "Text"
    labelText.Size = UDim2.new(1, -20, 1, 0)
    labelText.Position = UDim2.new(0, 10, 0, 0)
    labelText.BackgroundTransparency = 1
    labelText.Text = "Label"
    labelText.TextColor3 = Theme.Text
    labelText.TextSize = 14
    labelText.Font = Enum.Font.Gotham
    labelText.TextXAlignment = Enum.TextXAlignment.Left
    labelText.Parent = label
    
    return label
end

-- UI Library Functions
local currentTab = nil
local tabButtons = {}

-- Create a new window
function TCMD:CreateWindow(titleText)
    title.Text = " " .. titleText
    return mainWindow
end

-- Create a new tab
function TCMD:CreateTab(tabName)
    -- Create tab button
    local tabButton = Instance.new("TextButton")
    tabButton.Name = tabName
    tabButton.Size = UDim2.new(0.2, 0, 0.8, 0)
    tabButton.Position = UDim2.new(0.1 + (#tabButtons * 0.22), 0, 0.1, 0)
    tabButton.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
    tabButton.BackgroundTransparency = 0.8
    tabButton.Text = tabName
    tabButton.TextColor3 = Theme.Text
    tabButton.TextSize = 12
    tabButton.Font = Enum.Font.GothamSemibold
    tabButton.Parent = tabsContainer
    
    local tabCorner = Instance.new("UICorner")
    tabCorner.CornerRadius = UDim.new(0, 6)
    tabCorner.Parent = tabButton
    
    -- Tab content frame
    local tabContent = Instance.new("ScrollingFrame")
    tabContent.Name = tabName .. "_Content"
    tabContent.Size = UDim2.new(1, 0, 1, 0)
    tabContent.BackgroundTransparency = 1
    tabContent.ScrollBarThickness = 4
    tabContent.ScrollBarImageColor3 = Theme.Secondary
    tabContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
    tabContent.Visible = false
    tabContent.Parent = contentFrame
    
    local tabLayout = Instance.new("UIListLayout")
    tabLayout.Padding = UDim.new(0, 10)
    tabLayout.Parent = tabContent
    
    -- Select first tab by default
    if #tabButtons == 0 then
        currentTab = tabContent
        tabContent.Visible = true
        TweenService:Create(tabButton, TweenInfo.new(0.2), {
            BackgroundTransparency = 0.6,
            BackgroundColor3 = Theme.Primary
        }):Play()
    end
    
    -- Tab click handler
    tabButton.MouseButton1Click:Connect(function()
        -- Hide current tab
        if currentTab then
            currentTab.Visible = false
        end
        
        -- Reset all tab buttons
        for _, btn in pairs(tabButtons) do
            TweenService:Create(btn, TweenInfo.new(0.2), {
                BackgroundTransparency = 0.8,
                BackgroundColor3 = Color3.fromRGB(60, 60, 65)
            }):Play()
        end
        
        -- Show selected tab
        currentTab = tabContent
        tabContent.Visible = true
        
        -- Highlight selected button
        TweenService:Create(tabButton, TweenInfo.new(0.2), {
            BackgroundTransparency = 0.6,
            BackgroundColor3 = Theme.Primary
        }):Play()
    end)
    
    table.insert(tabButtons, tabButton)
    
    -- Return tab for adding elements
    local tabAPI = {}
    
    function tabAPI:AddButton(name, callback)
        local button = ElementTemplates.Button()
        button.Name = name
        button.Text.Text = name
        
        button.ClickArea.MouseButton1Click:Connect(function()
            if callback then
                callback()
            end
        end)
        
        button.Parent = tabContent
        return button
    end
    
    function tabAPI:AddToggle(name, default, callback)
        local toggle = ElementTemplates.Toggle()
        toggle.Name = name
        toggle.Text.Text = name
        
        local state = default or false
        
        -- Update toggle visual
        local function updateToggle()
            if state then
                TweenService:Create(toggle.Switch.Dot, TweenInfo.new(0.2), {
                    Position = UDim2.new(0.55, 0, 0.1, 0),
                    BackgroundColor3 = Theme.Success
                }):Play()
                TweenService:Create(toggle.Switch, TweenInfo.new(0.2), {
                    BackgroundColor3 = Color3.fromRGB(30, 30, 35)
                }):Play()
            else
                TweenService:Create(toggle.Switch.Dot, TweenInfo.new(0.2), {
                    Position = UDim2.new(0.05, 0, 0.1, 0),
                    BackgroundColor3 = Color3.fromRGB(40, 40, 45)
                }):Play()
                TweenService:Create(toggle.Switch, TweenInfo.new(0.2), {
                    BackgroundColor3 = Color3.fromRGB(70, 70, 75)
                }):Play()
            end
        end
        
        toggle.ClickArea.MouseButton1Click:Connect(function()
            state = not state
            updateToggle()
            if callback then
                callback(state)
            end
        end)
        
        updateToggle()
        toggle.Parent = tabContent
        
        return {
            Set = function(value)
                state = value
                updateToggle()
            end,
            Get = function()
                return state
            end
        }
    end
    
    function tabAPI:AddSlider(name, min, max, default, callback)
        local slider = ElementTemplates.Slider()
        slider.Name = name
        slider.Text.Text = name
        slider.Value.Text = tostring(default or min)
        
        local currentValue = default or min
        local dragging = false
        
        local function updateSlider(value)
            currentValue = math.clamp(value, min, max)
            local percentage = (currentValue - min) / (max - min)
            
            slider.Value.Text = tostring(math.floor(currentValue))
            slider.Fill.Size = UDim2.new(percentage, 0, 1, 0)
            
            if callback then
                callback(currentValue)
            end
        end
        
        slider.SliderButton.MouseButton1Down:Connect(function()
            dragging = true
        end)
        
        UserInputService.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
            end
        end)
        
        slider.SliderButton.MouseMoved:Connect(function()
            if dragging then
                local mousePos = UserInputService:GetMouseLocation()
                local sliderPos = slider.Track.AbsolutePosition
                local sliderSize = slider.Track.AbsoluteSize
                
                local relativeX = (mousePos.X - sliderPos.X) / sliderSize.X
                relativeX = math.clamp(relativeX, 0, 1)
                
                local newValue = min + (relativeX * (max - min))
                updateSlider(newValue)
            end
        end)
        
        updateSlider(currentValue)
        slider.Parent = tabContent
        
        return {
            Set = function(value)
                updateSlider(value)
            end,
            Get = function()
                return currentValue
            end
        }
    end
    
    function tabAPI:AddDropdown(name, options, default, callback)
        local dropdown = ElementTemplates.Dropdown()
        dropdown.Name = name
        dropdown.Text.Text = name
        
        local selected = default or options[1]
        local isOpen = false
        
        -- Update dropdown text
        local function updateDropdown()
            dropdown.Text.Text = name .. ": " .. selected
        end
        
        -- Create options
        local function createOptions()
            dropdown.Options:ClearAllChildren()
            
            for _, option in ipairs(options) do
                local optionButton = Instance.new("TextButton")
                optionButton.Size = UDim2.new(1, 0, 0, 30)
                optionButton.BackgroundColor3 = Color3.fromRGB(55, 55, 60)
                optionButton.BackgroundTransparency = 0.9
                optionButton.Text = option
                optionButton.TextColor3 = Theme.Text
                optionButton.TextSize = 13
                optionButton.Font = Enum.Font.Gotham
                optionButton.Parent = dropdown.Options
                
                local optionCorner = Instance.new("UICorner")
                optionCorner.CornerRadius = UDim.new(0, 6)
                optionCorner.Parent = optionButton
                
                -- Hover effect
                optionButton.MouseEnter:Connect(function()
                    TweenService:Create(optionButton, TweenInfo.new(0.2), {
                        BackgroundTransparency = 0.7
                    }):Play()
                end)
                
                optionButton.MouseLeave:Connect(function()
                    TweenService:Create(optionButton, TweenInfo.new(0.2), {
                        BackgroundTransparency = 0.9
                    }):Play()
                end)
                
                -- Click handler
                optionButton.MouseButton1Click:Connect(function()
                    selected = option
                    updateDropdown()
                    
                    if callback then
                        callback(option)
                    end
                    
                    -- Close dropdown
                    isOpen = false
                    TweenService:Create(dropdown.Options, TweenInfo.new(0.2), {
                        Size = UDim2.new(1, 0, 0, 0)
                    }):Play()
                    
                    task.wait(0.2)
                    dropdown.Options.Visible = false
                end)
            end
        end
        
        -- Toggle dropdown
        dropdown.DropdownButton.MouseButton1Click:Connect(function()
            isOpen = not isOpen
            
            if isOpen then
                createOptions()
                local optionCount = #options
                local optionHeight = math.min(optionCount * 35, 200)
                
                dropdown.Options.Visible = true
                dropdown.Options.Size = UDim2.new(1, 0, 0, 0)
                
                TweenService:Create(dropdown.Options, TweenInfo.new(0.2), {
                    Size = UDim2.new(1, 0, 0, optionHeight)
                }):Play()
                
                TweenService:Create(dropdown.Arrow, TweenInfo.new(0.2), {
                    Rotation = 180
                }):Play()
            else
                TweenService:Create(dropdown.Options, TweenInfo.new(0.2), {
                    Size = UDim2.new(1, 0, 0, 0)
                }):Play()
                
                TweenService:Create(dropdown.Arrow, TweenInfo.new(0.2), {
                    Rotation = 0
                }):Play()
                
                task.wait(0.2)
                dropdown.Options.Visible = false
            end
        end)
        
        updateDropdown()
        dropdown.Parent = tabContent
        
        return {
            Set = function(value)
                if table.find(options, value) then
                    selected = value
                    updateDropdown()
                end
            end,
            Get = function()
                return selected
            end
        }
    end
    
    function tabAPI:AddTextBox(name, placeholder, callback)
        local textbox = ElementTemplates.TextBox()
        textbox.Name = name
        textbox.Label.Text = name
        
        if placeholder then
            textbox.Input.PlaceholderText = placeholder
        end
        
        textbox.Input.FocusLost:Connect(function(enterPressed)
            if enterPressed and callback then
                callback(textbox.Input.Text)
            end
        end)
        
        textbox.Parent = tabContent
        
        return {
            Set = function(text)
                textbox.Input.Text = text or ""
            end,
            Get = function()
                return textbox.Input.Text
            end
        }
    end
    
    function tabAPI:AddLabel(name)
        local label = ElementTemplates.Label()
        label.Name = name
        label.Text.Text = name
        label.Parent = tabContent
        return label
    end
    
    return tabAPI
end

-- Toggle window visibility
function TCMD:Toggle()
    mainWindow.Visible = not mainWindow.Visible
    return mainWindow.Visible
end

-- Show window
function TCMD:Show()
    mainWindow.Visible = true
    return true
end

-- Hide window
function TCMD:Hide()
    mainWindow.Visible = false
    return false
end

-- Set window position
function TCMD:SetPosition(xScale, yScale, xOffset, yOffset)
    mainWindow.Position = UDim2.new(xScale, xOffset or 0, yScale, yOffset or 0)
end

-- Set window size
function TCMD:SetSize(xScale, yScale, xOffset, yOffset)
    mainWindow.Size = UDim2.new(xScale, xOffset or 0, yScale, yOffset or 0)
end

-- Set theme
function TCMD:SetTheme(newTheme)
    if newTheme == "Dark" then
        Theme = {
            Background = Color3.fromRGB(30, 30, 35),
            Header = Color3.fromRGB(40, 40, 45),
            Primary = Color3.fromRGB(86, 76, 251),
            Secondary = Color3.fromRGB(80, 80, 85),
            Text = Color3.fromRGB(240, 240, 240),
            Accent = Color3.fromRGB(255, 180, 255)
        }
    elseif newTheme == "Light" then
        Theme = {
            Background = Color3.fromRGB(245, 245, 245),
            Header = Color3.fromRGB(230, 230, 230),
            Primary = Color3.fromRGB(33, 150, 243),
            Secondary = Color3.fromRGB(200, 200, 200),
            Text = Color3.fromRGB(33, 33, 33),
            Accent = Color3.fromRGB(156, 39, 176)
        }
    elseif newTheme == "Red" then
        Theme = {
            Background = Color3.fromRGB(40, 30, 30),
            Header = Color3.fromRGB(60, 40, 40),
            Primary = Color3.fromRGB(244, 67, 54),
            Secondary = Color3.fromRGB(100, 70, 70),
            Text = Color3.fromRGB(240, 240, 240),
            Accent = Color3.fromRGB(255, 100, 100)
        }
    elseif newTheme == "Green" then
        Theme = {
            Background = Color3.fromRGB(30, 40, 30),
            Header = Color3.fromRGB(40, 60, 40),
            Primary = Color3.fromRGB(76, 175, 80),
            Secondary = Color3.fromRGB(70, 100, 70),
            Text = Color3.fromRGB(240, 240, 240),
            Accent = Color3.fromRGB(100, 255, 100)
        }
    end
    
    -- Apply theme
    mainWindow.BackgroundColor3 = Theme.Background
    headerBackground.BackgroundColor3 = Theme.Header
    title.TextColor3 = Theme.Text
    closeButton.TextColor3 = Theme.Text
    windowBorder.Color = Theme.Secondary
end

-- Close button handler
closeButton.MouseButton1Click:Connect(function()
    TCMD:Toggle()
end)

-- Initialize GUI
screenGui.Parent = game:GetService("CoreGui")

return TCMD
