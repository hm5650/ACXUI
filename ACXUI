-- Arceus X UI Library | Silent Aim Style (Clean & Fixed Minimize)
-- API остался почти тот же, только стиль как у Silent Aim

local lib = {}

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

-- Main GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ArceusX_SilentStyle"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local Main = Instance.new("Frame")
Main.Name = "Main"
Main.Size = UDim2.new(0, 240, 0, 320)
Main.Position = UDim2.new(0.5, -120, 0.5, -160)
Main.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Main.BorderSizePixel = 0
Main.Active = true
Main.Draggable = true
Main.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = Main

-- Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 30)
TitleBar.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = Main

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 8)
TitleCorner.Parent = TitleBar

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Size = UDim2.new(0.75, 0, 1, 0)
TitleLabel.Position = UDim2.new(0, 10, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "Arceus X"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextSize = 14
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.Parent = TitleBar

local MinimizeBtn = Instance.new("TextButton")
MinimizeBtn.Size = UDim2.new(0, 30, 0, 30)
MinimizeBtn.Position = UDim2.new(1, -30, 0, 0)
MinimizeBtn.BackgroundTransparency = 1
MinimizeBtn.Text = "—"
MinimizeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeBtn.Font = Enum.Font.Gotham
MinimizeBtn.TextSize = 18
MinimizeBtn.Parent = TitleBar

-- Content
local Content = Instance.new("ScrollingFrame")
Content.Size = UDim2.new(1, -16, 1, -40)
Content.Position = UDim2.new(0, 8, 0, 35)
Content.BackgroundTransparency = 1
Content.BorderSizePixel = 0
Content.ScrollBarThickness = 4
Content.ScrollBarImageColor3 = Color3.fromRGB(80, 80, 80)
Content.AutomaticCanvasSize = Enum.AutomaticSize.Y
Content.CanvasSize = UDim2.new(0, 0, 0, 0)
Content.Parent = Main

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 8)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Parent = Content

-- Templates
local ToggleTemplate = Instance.new("TextButton")
ToggleTemplate.Size = UDim2.new(1, 0, 0, 35)
ToggleTemplate.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
ToggleTemplate.Text = ""
ToggleTemplate.AutoButtonColor = false
ToggleTemplate.Font = Enum.Font.Gotham
ToggleTemplate.TextSize = 13
ToggleTemplate.TextXAlignment = Enum.TextXAlignment.Left

local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(0, 6)
ToggleCorner.Parent = ToggleTemplate

local ToggleText = Instance.new("TextLabel")
ToggleText.Size = UDim2.new(0.7, 0, 1, 0)
ToggleText.Position = UDim2.new(0, 12, 0, 0)
ToggleText.BackgroundTransparency = 1
ToggleText.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleText.Font = Enum.Font.Gotham
ToggleText.TextSize = 13
ToggleText.TextXAlignment = Enum.TextXAlignment.Left
ToggleText.Parent = ToggleTemplate

local ToggleIndicator = Instance.new("Frame")
ToggleIndicator.Size = UDim2.new(0, 44, 0, 22)
ToggleIndicator.Position = UDim2.new(1, -56, 0.5, -11)
ToggleIndicator.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
ToggleIndicator.Parent = ToggleTemplate

local IndicatorCorner = Instance.new("UICorner")
IndicatorCorner.CornerRadius = UDim.new(0, 11)
IndicatorCorner.Parent = ToggleIndicator

local Circle = Instance.new("Frame")
Circle.Size = UDim2.new(0, 18, 0, 18)
Circle.Position = UDim2.new(0, 3, 0.5, -9)
Circle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
Circle.Parent = ToggleIndicator

local CircleCorner = Instance.new("UICorner")
CircleCorner.CornerRadius = UDim.new(0, 9)
CircleCorner.Parent = Circle

local ButtonTemplate = ToggleTemplate:Clone()
ButtonTemplate:FindFirstChildOfClass("Frame"):Destroy() -- remove indicator

-- Minimize logic (БЕЗ ГЛЮКОВ — всё скрывается правильно)
local minimized = false
local normalSize = Main.Size
local normalPos = Main.Position

MinimizeBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        TweenService:Create(Main, TweenInfo.new(0.3), {Size = UDim2.new(0, 240, 0, 30)}):Play()
        MinimizeBtn.Text = "+"
        Content.Visible = false
    else
        TweenService:Create(Main, TweenInfo.new(0.3), {Size = normalSize}):Play()
        MinimizeBtn.Text = "—"
        task.wait(0.25)
        Content.Visible = true
    end
end)

-- Parent to correct place
ScreenGui.Parent = (gethui and gethui()) or Players.LocalPlayer:WaitForChild("PlayerGui")

-- Functions
function lib:SetTitle(text)
    TitleLabel.Text = text
end

function lib:SetIcon(id) -- не используется в этом стиле, но оставил для совместимости
end

function lib:AddToggle(name, callback, default)
    local toggle = ToggleTemplate:Clone()
    toggle:FindFirstChild("TextLabel").Text = name
    toggle.Parent = Content

    local enabled = default or false
    local function update()
        if enabled then
            toggle:FindFirstChild("Frame").BackgroundColor3 = Color3.fromRGB(0, 170, 255)
            Circle.Position = UDim2.new(1, -22, 0.5, -9)
        else
            toggle:FindFirstChild("Frame").BackgroundColor3 = Color3.fromRGB(60, 60, 60)
            Circle.Position = UDim2.new(0, 3, 0.5, -9)
        end
    end
    update()

    toggle.MouseButton1Click:Connect(function()
        enabled = not enabled
        TweenService:Create(Circle, TweenInfo.new(0.2), {Position = enabled and UDim2.new(1, -22, 0.5, -9) or UDim2.new(0, 3, 0.5, -9)}):Play()
        TweenService:Create(toggle:FindFirstChild("Frame"), TweenInfo.new(0.2), {BackgroundColor3 = enabled and Color3.fromRGB(0, 170, 255) or Color3.fromRGB(60, 60, 60)}):Play()
        callback(enabled)
    end)

    return toggle
end

function lib:AddButton(name, callback)
    local btn = ButtonTemplate:Clone()
    btn.TextLabel.Text = "  " .. name
    btn.Parent = Content

    btn.MouseButton1Click:Connect(callback)

    btn.MouseEnter:Connect(function() btn.BackgroundColor3 = Color3.fromRGB(55, 55, 55) end)
    btn.MouseLeave:Connect(function() btn.BackgroundColor3 = Color3.fromRGB(45, 45, 45) end)

    return btn
end

function lib:AddComboBox(name, options, callback)
    -- Простой комбобокс в том же стиле (раскрывается вниз)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 0, 35)
    frame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    frame.Parent = Content

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = frame

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.8, 0, 1, 0)
    label.Position = UDim2.new(0, 12, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = name .. ": " .. options[1]
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.Font = Enum.Font.Gotham
    label.TextSize = 13
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame

    local arrow = Instance.new("TextLabel")
    arrow.Size = UDim2.new(0, 30, 1, 0)
    arrow.Position = UDim2.new(1, -40, 0, 0)
    arrow.BackgroundTransparency = 1
    arrow.Text = "▼"
    arrow.TextColor3 = Color3.fromRGB(180, 180, 180)
    arrow.Font = Enum.Font.GothamBold
    arrow.Parent = frame

    local dropdown = Instance.new("Frame")
    dropdown.Size = UDim2.new(1, 0, 0, #options * 35)
    dropdown.Position = UDim2.new(0, 0, 1, 5)
    dropdown.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    dropdown.Visible = false
    dropdown.Parent = frame

    local dcorner = Instance.new("UICorner")
    dcorner.CornerRadius = UDim.new(0, 6)
    dcorner.Parent = dropdown

    for i, opt in ipairs(options) do
        local optbtn = ButtonTemplate:Clone()
        optbtn.Size = UDim2.new(1, 0, 0, 35)
        optbtn.TextLabel.Text = "  " .. opt
        optbtn.Parent = dropdown
        optbtn.LayoutOrder = i

        optbtn.MouseButton1Click:Connect(function()
            label.Text = name .. ": " .. opt
            dropdown.Visible = false
            callback(opt)
        end)
    end

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dropdown.Visible = not dropdown.Visible
        end
    end)

    return frame
end

-- Optional theme functions (оставил для совместимости)
function lib:SetBackgroundColor() end
function lib:SetButtonsColor() end
function lib:SetCloseBtnColor() end

return lib
